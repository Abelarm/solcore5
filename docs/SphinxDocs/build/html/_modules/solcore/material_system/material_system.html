
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>solcore.material_system.material_system &#8212; Solcore 5.0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '5.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Solcore 5.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/header2.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation and configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../structure.html">Structures and support classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Systems/Units.html">The Units System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Systems/Parameters.html">The Parameters System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Systems/Materials.html">The Materials System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Systems/Mobility.html">The mobility module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../QM/Schrodinger.html">1D arbitrary potential Schrödinger and k•p band structure solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Absorption/Absorption.html">Absorption calculator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spectral/spectral.html">Light Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ASC/ASC.html">Analytic solar cells calculator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PDD/DDsolver.html">Poisson - Drift-Diffusion solver (PDD)</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for solcore.material_system.material_system</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>  <span class="c1"># hyperbolic functions etc in parameterisation</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">lru_cache</span>  <span class="c1"># cache function calls to stop things taking forever / recalculating smae things</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">configparser</span>

<span class="kn">import</span> <span class="nn">solcore</span>
<span class="kn">from</span> <span class="nn">solcore.material_system</span> <span class="k">import</span> <span class="n">critical_point_interpolate</span>
<span class="kn">from</span> <span class="nn">solcore.parameter_system</span> <span class="k">import</span> <span class="n">ParameterSystem</span>
<span class="kn">from</span> <span class="nn">solcore.constants</span> <span class="k">import</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">q</span>
<span class="kn">from</span> <span class="nn">solcore.singleton</span> <span class="k">import</span> <span class="n">Singleton</span>
<span class="kn">from</span> <span class="nn">solcore.source_managed_class</span> <span class="k">import</span> <span class="n">SourceManagedClass</span>
<span class="kn">from</span> <span class="nn">solcore.absorption_calculator.sopra_db</span> <span class="k">import</span> <span class="n">sopra_database</span><span class="p">,</span> <span class="n">compounds_info</span>
<span class="kn">from</span> <span class="nn">solcore.material_data</span> <span class="k">import</span> <span class="n">calculate_mobility</span>


<div class="viewcode-block" id="MaterialSystem"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.MaterialSystem">[docs]</a><span class="k">class</span> <span class="nc">MaterialSystem</span><span class="p">(</span><span class="n">SourceManagedClass</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">Singleton</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The core class that manage the materials in solcore.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">SourceManagedClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known_materials</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;SOLCORE_ROOT&#39;</span><span class="p">,</span> <span class="n">solcore</span><span class="o">.</span><span class="n">SOLCORE_ROOT</span><span class="p">))</span>

<div class="viewcode-block" id="MaterialSystem.material"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.MaterialSystem.material">[docs]</a>    <span class="k">def</span> <span class="nf">material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sopra</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function checks if the requested material exists and creates a class that contains its properties,</span>
<span class="sd">        assuming that the material does not exists in the database, yet.</span>

<span class="sd">        Such class will serve as the base class for all the derived materials based on that SpecificMaterial.</span>
<span class="sd">        For example, N-type GaAs and P-type GaAs use the same SpecificMaterial, just with a different doping, and the</span>
<span class="sd">        happens with GaAs at 300K or 200K.</span>

<span class="sd">        The derived materials based on a SpecificMaterial are instances of the SpecificMaterial class.</span>

<span class="sd">        &gt;&gt;&gt; GaAs = solcore.material(&#39;GaAs&#39;)      # The SpecificMaterial class</span>
<span class="sd">        &gt;&gt;&gt; n_GaAs = GaAs(Nd=1e23)               # Instance of the class</span>
<span class="sd">        &gt;&gt;&gt; p_GaAs = GaAs(Na=1e22)               # Another instance of GaAs with different doping</span>

<span class="sd">        &gt;&gt;&gt; AlGaAs = solcore.material(&#39;AlGaAs&#39;)  # The SpecificMaterial class</span>
<span class="sd">        &gt;&gt;&gt; AlGaAs_1 = AlGaAs(Al=0.3)            # Instance of the class. For compounds, the variable element MUST be present</span>
<span class="sd">        &gt;&gt;&gt; AlGaAs_2 = AlGaAs(Al=0.7, T=290)     # Different composition and T (the default is T=300K)</span>

<span class="sd">        The material is created from the parameters in the parameter_system and the n and k.txt data if available. If the</span>
<span class="sd">        n and k.txt data does not exists - at all or for that composition - then n=1 and k.txt=0 at all wavelengths. Keep in</span>
<span class="sd">        mind that the available n and k.txt data is valid only at room temperature.</span>

<span class="sd">        :param name: Name of the material</span>
<span class="sd">        :param sopra: If a SOPRA material must be used, rather than the normal database material, in case both exist.</span>
<span class="sd">        :return: A class of that material</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># First we check if the material exists. If not, some help is provided</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sopra</span><span class="p">:</span>
                <span class="n">sopra_database</span><span class="p">(</span><span class="n">Material</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_sopra&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">configparser</span><span class="o">.</span><span class="n">NoSectionError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sopra_database</span><span class="p">(</span><span class="n">Material</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="n">sopra</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_sopra&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">valid_materials</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">sections</span><span class="p">())</span>
                <span class="n">valid_materials</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Immediate Calculables&#39;</span><span class="p">)</span>
                <span class="n">valid_materials</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Final Calculables&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Material ERROR: &quot;</span><span class="si">{}</span><span class="s1">&quot; is not in the semiconductors database or in the SOPRA database. Valid semiconductor materials are: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid_materials</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;x&quot;</span> <span class="ow">in</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> </span><span class="si">{}</span><span class="s1">  </span><span class="se">\t</span><span class="s1">x = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In compounds, check that the order of the elements is the correct one (eg. GaInSb is OK but InGaSb&#39;</span>
                      <span class="s1">&#39; is not).&#39;</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Do you want to see the list of available SOPRA materials (y/n)?&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="s1">&#39;Yy&#39;</span><span class="p">:</span>
                    <span class="n">sopra_database</span><span class="o">.</span><span class="n">material_list</span><span class="p">()</span>

                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">solcore</span><span class="o">.</span><span class="n">absorption_calculator</span><span class="o">.</span><span class="n">sopra_db</span><span class="o">.</span><span class="n">SOPRAError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Then we check if the material has already been created. If not, we create it.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">+</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_materials</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_materials</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sopra</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sopra_material</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterised_material</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="MaterialSystem.parameterised_material"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.MaterialSystem.parameterised_material">[docs]</a>    <span class="k">def</span> <span class="nf">parameterised_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function that actually creates the material class. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;x&quot;</span> <span class="ow">in</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[</span><span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">class</span> <span class="nc">SpecificMaterial</span><span class="p">(</span><span class="n">BaseMaterial</span><span class="p">):</span>
            <span class="n">material_string</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">composition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span>

            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">BaseMaterial</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">SpecificMaterial</span><span class="o">.</span><span class="n">material_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecificMaterial</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>

            <span class="n">SpecificMaterial</span><span class="o">.</span><span class="n">n_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpecificMaterial</span><span class="o">.</span><span class="n">material_directory</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
            <span class="n">SpecificMaterial</span><span class="o">.</span><span class="n">k_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpecificMaterial</span><span class="o">.</span><span class="n">material_directory</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>

        <span class="n">SpecificMaterial</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">known_materials</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpecificMaterial</span>
        <span class="k">return</span> <span class="n">SpecificMaterial</span></div>

<div class="viewcode-block" id="MaterialSystem.sopra_material"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.MaterialSystem.sopra_material">[docs]</a>    <span class="k">def</span> <span class="nf">sopra_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates an optical material fromt he SOPRA database. &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[</span><span class="n">compounds_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">class</span> <span class="nc">SpecificMaterial</span><span class="p">(</span><span class="n">BaseMaterial</span><span class="p">):</span>
            <span class="n">material_string</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">composition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">sopra_database</span><span class="p">(</span><span class="n">Material</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">BaseMaterial</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>  <span class="c1"># only used for unknown attributes</span>
                <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_interpolated</span>
                <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;k&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_interpolated</span>

                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{}</span><span class="s1">&quot; not available for this SOPRA material &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">))</span>

            <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">load_n_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">wl</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_n</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">wl</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

            <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">load_k_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">wl</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_k</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">wl</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">n_interpolated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t interpolate 2d spectra yet&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_n_data</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Material &quot;</span><span class="si">{}</span><span class="s1">&quot; has not n-data defined. Returning &quot;ones&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wl</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">trash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_composition</span><span class="p">(</span><span class="n">Lambda</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span><span class="o">*</span><span class="mi">100</span><span class="p">})</span>

                <span class="k">return</span> <span class="n">y</span>

            <span class="k">def</span> <span class="nf">k_interpolated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t interpolate 2d spectra yet&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_k_data</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Material &quot;</span><span class="si">{}</span><span class="s1">&quot; has not k-data defined. Returning &quot;ones&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wl</span><span class="p">,</span> <span class="n">trash</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_composition</span><span class="p">(</span><span class="n">Lambda</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span><span class="o">*</span><span class="mi">100</span><span class="p">})</span>

                <span class="k">return</span> <span class="n">y</span>


        <span class="n">SpecificMaterial</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_sopra&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">known_materials</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_sopra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpecificMaterial</span>
        <span class="k">return</span> <span class="n">SpecificMaterial</span></div></div>


<div class="viewcode-block" id="BaseMaterial"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial">[docs]</a><span class="k">class</span> <span class="nc">BaseMaterial</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; The solcore base material class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">material_string</span> <span class="o">=</span> <span class="s2">&quot;Unnamed&quot;</span>
    <span class="n">composition</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">main_fraction</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">material_directory</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">k_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">n_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">strained</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Na</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;Na&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;Na&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;Nd&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;Nd&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">element</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_parameters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>  <span class="c1"># only used for unknown attributes</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_interpolated</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;k&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_interpolated</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;electron_affinity&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># from http://en.wikipedia.org/wiki/Anderson&#39;s_rule and GaAs values</span>
                <span class="k">return</span> <span class="p">(</span><span class="mf">0.17</span> <span class="o">+</span> <span class="mf">4.59</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence_band_offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_gap</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;electron_mobility&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">calculate_mobility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s2">&quot;hole_mobility&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">calculate_mobility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Na</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">ParameterSystem</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="BaseMaterial.load_n_data"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.load_n_data">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">load_n_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_path</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_critical_points</span> <span class="o">=</span> <span class="n">critical_point_interpolate</span><span class="o">.</span><span class="n">load_data_from_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseMaterial.load_k_data"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.load_k_data">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">load_k_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_path</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_critical_points</span> <span class="o">=</span> <span class="n">critical_point_interpolate</span><span class="o">.</span><span class="n">load_data_from_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseMaterial.n_interpolated"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.n_interpolated">[docs]</a>    <span class="k">def</span> <span class="nf">n_interpolated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t interpolate 2d spectra yet&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_n_data</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Material &quot;</span><span class="si">{}</span><span class="s1">&quot; has not n-data defined. Returning &quot;ones&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_points_n</span> <span class="o">=</span> <span class="n">critical_point_interpolate</span><span class="o">.</span><span class="n">critical_point_interpolate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_critical_points</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span><span class="p">,</span>
                <span class="n">x</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="BaseMaterial.k_interpolated"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.k_interpolated">[docs]</a>    <span class="k">def</span> <span class="nf">k_interpolated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t interpolate 2d spectra yet&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_k_data</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Material &quot;</span><span class="si">{}</span><span class="s1">&quot; has not k-data defined. Returning &quot;zeros&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_points_k</span> <span class="o">=</span> <span class="n">critical_point_interpolate</span><span class="o">.</span><span class="n">critical_point_interpolate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_critical_points</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_fraction</span><span class="p">,</span>
                <span class="n">x</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="BaseMaterial.get"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseMaterial.alpha"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.alpha">[docs]</a>    <span class="k">def</span> <span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span> <span class="o">/</span> <span class="n">wavelength</span></div>

<div class="viewcode-block" id="BaseMaterial.alphaE"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.alphaE">[docs]</a>    <span class="k">def</span> <span class="nf">alphaE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">energy</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseMaterial.latex_string"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.latex_string">[docs]</a>    <span class="k">def</span> <span class="nf">latex_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_string</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_{{</span><span class="si">{:.3f}</span><span class="s2">}}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;$\mathrm{{</span><span class="si">{}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseMaterial.plain_string"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.plain_string">[docs]</a>    <span class="k">def</span> <span class="nf">plain_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_string</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}{:.3f}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseMaterial.html_string"><a class="viewcode-back" href="../../../Systems/Materials.html#solcore.material_system.material_system.BaseMaterial.html_string">[docs]</a>    <span class="k">def</span> <span class="nf">html_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_string</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&lt;sub&gt;</span><span class="si">{:.3f}</span><span class="s2">&lt;/sub&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_parameters</span><span class="p">]</span>
        <span class="n">parameters_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;&#39;</span><span class="si">{}</span><span class="s2">&#39; material</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">material_string</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">parameters_string</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Solcore 5.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Quantum Photovoltaics Group, Imperial College London.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>