
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>solcore.solar_cell_solver &#8212; Solcore 5.3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Solcore 5.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/header2.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation/installation.html">Installation and configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Structures/structure.html">Structures and support classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Systems/systems.html">Materials and units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../QM/Schrodinger.html">Quantum Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spectral/spectral.html">Light Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Optics/optics.html">Optical methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Solvers/solving_solar_cells.html">Solar cell solvers</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for solcore.solar_cell_solver</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">solcore.analytic_solar_cells</span> <span class="k">as</span> <span class="nn">ASC</span>
<span class="kn">from</span> <span class="nn">solcore.light_source</span> <span class="k">import</span> <span class="n">LightSource</span>
<span class="kn">from</span> <span class="nn">solcore.state</span> <span class="k">import</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">solcore.optics</span> <span class="k">import</span> <span class="n">solve_beer_lambert</span><span class="p">,</span> <span class="n">solve_tmm</span><span class="p">,</span> <span class="n">solve_rcwa</span><span class="p">,</span> <span class="n">rcwa_options</span><span class="p">,</span> <span class="n">solve_external_optics</span>
<span class="kn">from</span> <span class="nn">solcore.structure</span> <span class="k">import</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">Junction</span><span class="p">,</span> <span class="n">TunnelJunction</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">solcore.poisson_drift_diffusion</span> <span class="k">as</span> <span class="nn">PDD</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">PDD</span><span class="o">.</span><span class="n">pdd_options</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">PDD</span><span class="o">.</span><span class="n">pdd_options</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">default_options</span> <span class="o">=</span> <span class="n">State</span><span class="p">()</span>


<div class="viewcode-block" id="merge_dicts"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.merge_dicts">[docs]</a><span class="k">def</span> <span class="nf">merge_dicts</span><span class="p">(</span><span class="o">*</span><span class="n">dict_args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given any number of dicts, shallow copy and merge into a new dict,</span>
<span class="sd">    precedence goes to key value pairs in latter dicts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">State</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="n">dict_args</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>


<span class="c1"># General</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">T_ambient</span> <span class="o">=</span> <span class="mi">298</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">298</span>

<span class="c1"># Illumination spectrum</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">251</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">light_source</span> <span class="o">=</span> <span class="n">LightSource</span><span class="p">(</span><span class="n">source_type</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;AM1.5g&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">default_options</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
                                           <span class="n">output_units</span><span class="o">=</span><span class="s1">&#39;photon_flux_per_m&#39;</span><span class="p">)</span>

<span class="c1"># IV control</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">voltages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">mpp</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">light_iv</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">internal_voltages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4660</span><span class="p">,</span> <span class="mi">4661</span><span class="p">)</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">radiative_coupling</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Optics control</span>
<span class="n">default_options</span><span class="o">.</span><span class="n">optics_method</span> <span class="o">=</span> <span class="s1">&#39;BL&#39;</span>

<span class="n">default_options</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="n">default_options</span><span class="p">,</span> <span class="n">ASC</span><span class="o">.</span><span class="n">db_options</span><span class="p">,</span> <span class="n">PDD</span><span class="o">.</span><span class="n">pdd_options</span><span class="p">,</span> <span class="n">rcwa_options</span><span class="p">)</span>


<div class="viewcode-block" id="solar_cell_solver"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.solar_cell_solver">[docs]</a><span class="k">def</span> <span class="nf">solar_cell_solver</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">user_options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Solves the properties of a solar cell object, either calculating its optical properties (R, A and T), its quantum efficiency or its current voltage characteristics in the dark or under illumination. The general options for the solvers are passed as dicionaries.</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :param task: Task to perform. It has to be &quot;optics&quot;, &quot;iv&quot;, &quot;qe&quot;, &quot;equilibrium&quot; or &quot;short_circuit&quot;. The last two only work for PDD junctions</span>
<span class="sd">    :param user_options: A dictionary containing the options for the solver, which will overwrite the default options.</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">user_options</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="n">default_options</span><span class="p">,</span> <span class="n">user_options</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="n">default_options</span><span class="p">)</span>

    <span class="n">prepare_solar_cell</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">solar_cell</span><span class="o">.</span><span class="n">T</span>

    <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">&#39;optics&#39;</span><span class="p">:</span>
        <span class="n">solve_optics</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">&#39;iv&#39;</span><span class="p">:</span>
        <span class="n">solve_iv</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">&#39;qe&#39;</span><span class="p">:</span>
        <span class="n">solve_qe</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">&#39;equilibrium&#39;</span><span class="p">:</span>
        <span class="n">solve_equilibrium</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">&#39;short_circuit&#39;</span><span class="p">:</span>
        <span class="n">solve_short_circuit</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;ERROR in &quot;solar_cell_solver&quot;:</span><span class="se">\n\t</span><span class="s1">Valid values for &quot;task&quot; are: &quot;optics&quot;, &quot;iv&quot;, &quot;qe&quot;, &quot;equilibrium&quot; and &quot;short_circuit&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="solve_optics"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.solve_optics">[docs]</a><span class="k">def</span> <span class="nf">solve_optics</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Solves the optical properties of the structure, calculating the reflectance, absorptance and transmitance. The &quot;optics_method&quot; option controls which method is used to calculate the optical properties of the solar cell:</span>

<span class="sd">    - None: The calculation is skipped. Only useful for solar cells involving just &quot;2-diode&quot; kind of junctions.</span>
<span class="sd">    - BL: Uses the Beer-Lambert law to calculate the absorption in each layer. Front surface reflexion has to provided externally. It is the default method and the most flexible one.</span>
<span class="sd">    - TMM: Uses a transfer matrix calculation to obtain the RAT. Not valid for DB or 2D junction</span>
<span class="sd">    - RCWA: Uses the rigorous wave coupled analysisto obtain the RAT. This allows to include 2D photonic crystals in the structure, for example. Not valid for DB or 2D junctions</span>
<span class="sd">    - external: The reflection and absorption profiles are provided externally by the user, and therefore no calculation is performed by Solcore.</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :param options: Options for the optics solver</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solving optics of the solar cell...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">optics_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Not solving the optics of the solar cell.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">optics_method</span> <span class="o">==</span> <span class="s1">&#39;external&#39;</span><span class="p">:</span>
        <span class="n">solve_external_optics</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">optics_method</span> <span class="o">==</span> <span class="s1">&#39;BL&#39;</span><span class="p">:</span>
        <span class="n">solve_beer_lambert</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">optics_method</span> <span class="o">==</span> <span class="s1">&#39;TMM&#39;</span><span class="p">:</span>
        <span class="n">solve_tmm</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">optics_method</span> <span class="o">==</span> <span class="s1">&#39;RCWA&#39;</span><span class="p">:</span>
        <span class="n">solve_rcwa</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;ERROR in &quot;solar_cell_solver&quot;:</span><span class="se">\n\t</span><span class="s1">Optics solver method must be None, &quot;external&quot;, &quot;BL&quot;, &quot;TMM&quot; or &quot;RCWA&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="solve_iv"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.solve_iv">[docs]</a><span class="k">def</span> <span class="nf">solve_iv</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculates the IV at a given voltage range, providing the IVs of the individual junctions in addition to the total IV</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :param options: Options for the solvers</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solve_optics</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">solar_cell</span><span class="o">.</span><span class="n">junction_indices</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;PDD&#39;</span><span class="p">:</span>
            <span class="n">PDD</span><span class="o">.</span><span class="n">iv_pdd</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;DA&#39;</span><span class="p">:</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">iv_depletion</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">iv_2diode</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;DB&#39;</span><span class="p">:</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">iv_detailed_balance</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;ERROR in &quot;solar_cell_solver&quot;:</span><span class="se">\n\t</span><span class="s1">Junction </span><span class="si">{}</span><span class="s1"> has an invalid &quot;type&quot;. It must be &quot;PDD&quot;, &quot;DA&quot;, &quot;2D&quot; or &quot;DB&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">solar_cell</span><span class="o">.</span><span class="n">tunnel_indices</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;resistive&#39;</span><span class="p">:</span>
            <span class="c1"># The tunnel junction is modeled as a simple resistor</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">resistive_tunnel_junction</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;parametric&#39;</span><span class="p">:</span>
            <span class="c1"># The tunnel junction is modeled using a simple parametric model</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">parametric_tunnel_junction</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;external&#39;</span><span class="p">:</span>
            <span class="c1"># The tunnel junction is modeled using a simple parametric model</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">external_tunnel_junction</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;analytic&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sorry, the analytical tunnel junction model is not implemented, yet.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;ERROR in &quot;solar_cell_solver&quot;:</span><span class="se">\n\t</span><span class="s1">Tunnel junction </span><span class="si">{}</span><span class="s1"> has an invalid &quot;type&quot;. It must be &quot;parametric&quot;, &quot;analytic&quot;, &quot;external&quot; or &quot;resistive&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">))</span>

    <span class="n">ASC</span><span class="o">.</span><span class="n">iv_multijunction</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>


<div class="viewcode-block" id="solve_qe"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.solve_qe">[docs]</a><span class="k">def</span> <span class="nf">solve_qe</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculates the QE of all the junctions</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :param options: Options for the solvers</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">solve_optics</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">solar_cell</span><span class="o">.</span><span class="n">junction_indices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;PDD&#39;</span><span class="p">:</span>
            <span class="n">PDD</span><span class="o">.</span><span class="n">qe_pdd</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;DA&#39;</span><span class="p">:</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">qe_depletion</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
            <span class="c1"># We solve this case as if it were DB. Therefore, to work it needs the same inputs in the Junction object</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">wavelength</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">qe_detailed_balance</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">wl</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;DB&#39;</span><span class="p">:</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">wavelength</span>
            <span class="n">ASC</span><span class="o">.</span><span class="n">qe_detailed_balance</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">wl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;ERROR in &quot;solar_cell_solver&quot;:</span><span class="se">\n\t</span><span class="s1">Junction </span><span class="si">{}</span><span class="s1"> has an invalid &quot;type&quot;. It must be &quot;PDD&quot;, &quot;DA&quot;, &quot;2D&quot; or &quot;DB&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">))</span></div>


<div class="viewcode-block" id="solve_equilibrium"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.solve_equilibrium">[docs]</a><span class="k">def</span> <span class="nf">solve_equilibrium</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uses the PDD solver to calculate the properties of all the all the junctions under equilibrium</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :param options: Options for the solvers</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">solar_cell</span><span class="o">.</span><span class="n">junction_indices</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;PDD&#39;</span><span class="p">:</span>
            <span class="n">PDD</span><span class="o">.</span><span class="n">equilibrium_pdd</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Only PDD junctions can be solved in &quot;equilibrium&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="solve_short_circuit"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.solve_short_circuit">[docs]</a><span class="k">def</span> <span class="nf">solve_short_circuit</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uses the PDD solver to calculate the properties of all the all the junctions under short circuit</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :param options: Options for the solvers</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solve_optics</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">solar_cell</span><span class="o">.</span><span class="n">junction_indices</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;PDD&#39;</span><span class="p">:</span>
            <span class="n">PDD</span><span class="o">.</span><span class="n">short_circuit_pdd</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Only PDD junctions can be solved in &quot;short_circuit&quot;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="prepare_solar_cell"><a class="viewcode-back" href="../../Solvers/solving_solar_cells.html#solcore.solar_cell_solver.prepare_solar_cell">[docs]</a><span class="k">def</span> <span class="nf">prepare_solar_cell</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function scans all the layers and junctions of the cell, calculating the relative possition of each of them with respect the front surface (offset). This information will later be use by the optical calculators, for example.</span>

<span class="sd">    :param solar_cell: A solar_cell object</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">layer_object</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solar_cell</span><span class="p">):</span>

        <span class="c1"># Independent layers, for example in a AR coating</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">layer_object</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Layer</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Each Tunnel junctions can also have some layers with a given thickness.</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">layer_object</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TunnelJunction</span><span class="p">:</span>
            <span class="n">junction_width</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">layer_object</span><span class="p">):</span>
                <span class="n">junction_width</span> <span class="o">+=</span> <span class="n">layer</span><span class="o">.</span><span class="n">width</span>
            <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">junction_width</span>

        <span class="c1"># For each junction, and layer within the junction, we get the layer width.</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">layer_object</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Junction</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR preparing the solar cell: Junction </span><span class="si">{}</span><span class="s1"> has no kind!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">err</span>

            <span class="c1"># This junctions will not, typically, have a width</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2D&#39;</span><span class="p">,</span> <span class="s1">&#39;DB&#39;</span><span class="p">]:</span>
                <span class="c1"># 2D and DB junctions do not often have a width (or need it) so we set an arbitrary width</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">layer_object</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">):</span>
                    <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># 1 µm</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">junction_width</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">layer_object</span><span class="p">):</span>
                    <span class="n">junction_width</span> <span class="o">+=</span> <span class="n">layer</span><span class="o">.</span><span class="n">width</span>
                <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">junction_width</span>

        <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="n">solar_cell</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">width</span>

    <span class="n">solar_cell</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">offset</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Solcore 5.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Quantum Photovoltaics Group, Imperial College London.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>